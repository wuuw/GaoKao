<div class="alert alert-primary info" role="alert">
  <span style="color:#ddd">参考年份: <b style="color:#fff;font-size:1.1em">{{query.year}}</b></span>
  <span style="color:#ddd">考生来源: <b style="color:#fff;font-size:1.1em">{{query.pos}}</b></span>
  <span style="color:#ddd">考生科类: <b style="color:#fff;font-size:1.1em">{{query.category}}</b></span>
  <span style="color:#ddd">高考分数: <b style="color:#fff;font-size:1.1em">{{query.score}}</b></span>
  <span style="color:#ddd">查找线差: <b style="color:#fff;font-size:1.1em">{{query.score - query.range - line}} 至 {{query.score + query.range - line}} 分</b></span>
  {% if query.type.indexOf('major') >= 0 %}
  <span style="color:#ddd">专业: <b style="color:#fff;font-size:1.1em">{{majors[0].name}}</b></span>
  {% endif %}
</div>

<div class="btn-group">
  <span class="badge badge-primary">院校地区 </span>
  <select class="custom-select" id="city">
    <option selected value="0">所有地区</option>
    <option value="1">北京市</option>
    <option value="2">天津市</option>
    <option value="3">河北省</option>
    <option value="4">山西省</option>
    <option value="5">内蒙古自治区</option>
    <option value="6">辽宁省</option>
    <option value="7">吉林省</option>
    <option value="8">黑龙江省</option>
    <option value="9">上海市</option>
    <option value="10">江苏省</option>
    <option value="11">浙江省</option>
    <option value="12">安徽省</option>
    <option value="13">福建省</option>
    <option value="14">江西省</option>
    <option value="15">山东省</option>
    <option value="16">河南省</option>
    <option value="17">湖北省</option>
    <option value="18">湖南省</option>
    <option value="19">广东省</option>
    <option value="20">广西壮族自治区</option>
    <option value="21">海南省</option>
    <option value="22">重庆市</option>
    <option value="23">四川省</option>
    <option value="24">贵州省</option>
    <option value="25">云南省</option>
    <option value="26">西藏自治区</option>
    <option value="27">陕西省</option>
    <option value="28">甘肃省</option>
    <option value="29">青海省</option>
    <option value="30">宁夏回族自治区</option>
    <option value="31">新疆维吾尔自治区</option>
  </select>
  <span class="badge badge-primary">所属工程 </span>
  <label class="custom-control custom-checkbox">
    <input type="checkbox" id="nef" class="custom-control-input">
    <span class="custom-control-indicator" style="z-index:10"></span>
    <span class="custom-control-description">985</span>
  </label>
  <label class="custom-control custom-checkbox">
    <input type="checkbox" id="too" class="custom-control-input">
    <span class="custom-control-indicator" style="z-index:10"></span>
    <span class="custom-control-description">211</span>
  </label>
</div>

<div class="card">


<table class="table table-striped">
  <!-- 学校查找 -->
  {% if query.type.indexOf('school') >= 0 %}
  <thead>
    <tr>
      <th style="text-align:left;padding-left:20px;padding-right:0;">高校名称</th>
      <th>所在地</th>
      <th>录取批次(省控线)</th>
      <th>调档线</th>
      <th>平均分</th>
      <th>录取线差</th>
      <th>平均线差</th>
      <th>招生网</th>
    </tr>
  </thead>
  <tbody>
    {% for item in schools %}
    <tr>
      <th scope="row" class="name" style="text-align:left;padding-left:20px;padding-right:0;">
        <span style = "font-size:1.2em;">
          {{item.name}}
          <span style="color:#9c27b0;font-size:0.8em;">{{item.project}}</span>
        </span>
      </th>
      <td>{{item.position}}</td>
      <td>
        {{item.batch}} ({{line}})
      </td>
      <td>{{item.minScore}}</td>
      <td>{{item.avgScore}}</td>
      <td>
        {{item.minScore - line}}
      </td>
      <td>
        {{item.avgScore - line}}
      </td>
      <td>
        {% if item.site %}
        <a href="{{item.site}}" target="_blank">进入</a>
        {% else %}
        <a href="javascriot:void(0)"></a>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
  <!-- 专业查找 -->
  {% else%}
  <thead>
    <tr>
      <th style="text-align:left;padding-left:20px;padding-right:0;">高校名称</th>
      <th>所在地</th>
      <th>专业名称</th>
      <th>录取批次(分数线)</th>
      <th>专业最低分</th>
      <th>专业平均分</th>
      <th>专业最高分</th>
      <th>专业解读</th>
    </tr>
  </thead>
  <tbody>
    {% for item in majors %}
    <tr>
      <th scope="row" class="name" style="text-align:left;padding-left:20px;padding-right:0;">
        <span style="font-size:1.2em">
          {{item.school_name}}
          <span style="color:#9c27b0;font-size:0.8em">
            {{item.project}}
          </span>
        </span>
      </th>
      <td>{{item.school_pos}}</td>
      <td>{{item.name}}</td>
      <td>{{item.batch}} ({{line}})</td>
      <td>{{item.minScore}}</td>
      <td>{{item.avgScore}}</td>
      <td>{{item.maxScore}}</td>
      <td>
        <a href="javascript:void(0)">查看</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>

  {% endif %}

</table>

<!-- 总页数大于1则显示页码 -->
{% if totalPages > 1 %}
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li class="page-item {%if page == 1%}disabled{%endif%}">
      <a class="page-link" tabindex="-1"> < </a>
    </li>
    {% for i in range(1, totalPages + 1) -%}
    <li class="page-item {% if i == query.page %}active{%endif%}">
      <a class="page-link">{{i}}</a>
    </li>
    {%- endfor %}
    <li class="page-item {%if page == totalPages%}disabled{%endif%}">
      <a class="page-link"> > </a>
    </li>
  </ul>
</nav>
{%endif%}
<!-- 处理分页 -->
<script type="text/javascript">
  "use strict";
  //找到page 部分并删除
  let urlArray = window.location.href.split('&');
  urlArray.forEach((str, index) => {
    if(str.indexOf('page') >= 0) {
      urlArray.splice(index, 1);
    }
  });
  //删除page后的链接
  let urlWithoutPage = urlArray.join('&');

  //绑定click事件
  let lists = $(".pagination li");
  lists.each(function(index) {
    //上一页
    if (index === 0) {
      $(this).one('click', function() {
        window.location.href = urlWithoutPage + "&page=" + {{page - 1}};
      });
    } else if (index === lists.length - 1) {
      $(this).one('click', function() {
        window.location.href = urlWithoutPage + "&page=" + {{page + 1}};
      });
    } else {
      $(this).one('click', function() {
        window.location.href = urlWithoutPage + "&page=" + index;
      })
    }
  });
  // 处理大学所在城市的选择
  $('#city').change(filter);
  $('#nef').change(filter);
  $('#too').change(filter);


  function filter() {
    console.log([$('#nef').is(':checked'), $('#too').is(':checked')]);
    $.ajax({
      type: 'POST',
      url: "/result/index",
      data: {
        city: $('#city option:selected').text(),
        is985: $('#nef').is(':checked'),
        is211: $('#too').is(':checked'),
        type: '{{query.type}}',
        pos: '{{query.pos}}',
        year: '{{query.year}}',
        scoreType: '{{query.scoreType}}',
        category: '{{query.category}}',
        major: {%if query.major %}'{{query.major}}'{%else%}null{%endif%},
        score: parseInt({{query.score}}),
        range: parseInt({{query.range}})
      },
      dataType: 'json'
    }).done(function(data) {
      console.log(data);
    });
  }
</script>
</div>
